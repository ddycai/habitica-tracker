(this["webpackJsonphabitica-tracker"]=this["webpackJsonphabitica-tracker"]||[]).push([[0],{109:function(e,t,a){},110:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(24),c=a.n(l),o=(a(31),a(3)),s=(a(32),a(12)),i=a.n(s),u=a(4),m=a.n(u),d=a(13),f=a.n(d);f.a.setLevel("ERROR");var E=f.a,h=a(26);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function v(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var b=n.createElement("path",{fillRule:"evenodd",d:"M10.667 10.667L16 8l-5.333-2.667L8 0 5.333 5.333 0 8l5.333 2.667L8 16z"});function y(e,t){var a=e.title,r=e.titleId,l=v(e,["title","titleId"]);return n.createElement("svg",p({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",ref:t,"aria-labelledby":r},l),a?n.createElement("title",{id:r},a):null,b)}var w=n.forwardRef(y),O=(a.p,a(36),"ddd MMM D"),k="MMM D YYYY";function N(e){var t,a,l=Object(n.useContext)(B),c=["task-icon-container","center-wrapper",S(e.task)].join(" "),o=(t=e.task.priority,Math.ceil(t/.5)),s=Array.from({length:o},(function(e,t){return r.a.createElement(w,{key:t,fill:"white","aria-hidden":!0})})),i=e.task.value.toFixed(1);return e.task.nextDue&&(a=m()(e.task.nextDue[0])),l.showTaskIcons?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-tip":!0,"data-for":e.task.id,className:c},s),r.a.createElement(h.a,{id:e.task.id,place:"left",effect:"solid"},a?r.a.createElement("div",null,r.a.createElement("b",null,"Next due:")," ",function(e){var t=m()();return e.diff(t,"day")<1?"tomorrow":e.diff(t,"day")<6?e.format("dddd"):e.year===m()().year?e.format(O):e.format(k)}(a)):null,r.a.createElement("div",null,r.a.createElement("b",null,"Task value:")," ",i))):null}var g=[-16,-9,-1,1,6,12],j=["worst","worse","bad","neutral","good","better"];function S(e){for(var t=0;t<g.length;t++)if(e.value<g[t])return j[t];return"best"}var M=a(14);function T(e){var t=Object(n.useContext)(B);return r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,r.a.createElement("div",{className:"section-header"},r.a.createElement("div",{className:"section-header-title"},r.a.createElement("h2",null,e.title),r.a.createElement("div",{role:"button",className:"show-no-history clickable",title:"Show/Hide tasks with no data",onClick:function(){return e.setShowNoHistory(!e.showNoHistory)}},e.showNoHistory?r.a.createElement(M.a,{"aria-hidden":"true"}):r.a.createElement(M.b,{"aria-hidden":"true"}))))),t.dates.map((function(e){return r.a.createElement("th",{key:e.toString()},r.a.createElement("div",{className:"date date-heading"},r.a.createElement("span",null,e.format("ddd")),r.a.createElement("span",null,e.format("DD"))))}))))}var R=a(6);function D(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],c=a[1];return r.a.createElement("section",{className:"dailys"},r.a.createElement("table",null,r.a.createElement(T,{title:"Dailies",setShowNoHistory:c,showNoHistory:l}),r.a.createElement("tbody",null,e.data.map((function(e){return r.a.createElement(I,{key:e.id,showNoHistory:l,daily:e})})))),r.a.createElement("div",{className:"link show-no-history",onClick:function(){return c(!l)}}))}function I(e){var t=Object(n.useContext)(B),a=new Map,l=e.daily,c=l.text,o=l.history;E.debug(c);for(var s=1;s<o.length;s++){var i=o[s].value-o[s-1].value,u=m()(o[s].date);if(E.debug(u.format("YYYY-MM-DD HH:mm:ss")+": "+o[s].value),0!==i){if(t.cronIntervals.search(u.unix(),u.unix()).length>0){var d=u.subtract(1,"day");a.has(d.format(z))?a.has(u.format(z))&&E.warn("Too many completions for ".concat(c," on ").concat(u)):u=d}var f=u.format(z);a.set(f,i)}}console.groupEnd();var h=t.dates.map((function(e){return e.format(z)})).map((function(e){return{day:e,delta:a.get(e)}}));return 0!==h.filter((function(e){return void 0!==e.delta})).length||e.showNoHistory?r.a.createElement("tr",null,r.a.createElement("td",{className:"task-name-row"},r.a.createElement(N,{task:e.daily}),r.a.createElement("span",{className:"task-name",dangerouslySetInnerHTML:{__html:R.render(c)}})),h.map((function(e){var t=e.day,a=e.delta;return r.a.createElement(x,{key:t,delta:a})}))):null}function x(e){var t,a=["daily-cell"];return e.delta&&0!==e.delta?e.delta>0?(a.push("success"),t="\u2713"):(a.push("fail"),t="\u2716"):(a.push("pass"),t="\xa0"),r.a.createElement("td",{className:a.join(" ")},t&&r.a.createElement("div",{className:"center-wrapper"},r.a.createElement("span",{className:"symbol"},t)))}var C=a(25),H=a(6);function Y(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],c=a[1];return r.a.createElement("section",{className:"habits"},r.a.createElement("table",null,r.a.createElement(T,{title:"Habits",setShowNoHistory:c,showNoHistory:l}),r.a.createElement("tbody",null,e.data.map((function(e){return r.a.createElement(_,{key:e.id,showNoHistory:l,habit:e})})))))}function _(e){var t=Object(n.useContext)(B),a=new Map,l=e.habit,c=l.text,o=l.history;E.debug(c);var s,i=Object(C.a)(o);try{for(i.s();!(s=i.n()).done;){var u=s.value,d=m()(u.date).format(z);E.debug(JSON.stringify(u)),void 0!==u.scoredUp&&void 0!==u.scoredDown&&a.set(d,[u.scoredUp,u.scoredDown])}}catch(h){i.e(h)}finally{i.f()}var f=t.dates.map((function(e){return e.format(z)})).map((function(e){return{day:e,score:a.get(e)}}));return 0!==f.filter((function(e){return void 0!==e.score})).length||e.showNoHistory?r.a.createElement("tr",null,r.a.createElement("td",{className:"task-name-row"},r.a.createElement(N,{task:e.habit}),r.a.createElement("span",{className:"task-name",dangerouslySetInnerHTML:{__html:H.render(c)}})),f.map((function(e){var t=e.day,a=e.score;return a?r.a.createElement(P,{key:t,up:a[0],down:a[1]}):r.a.createElement("td",{key:t,className:"habit-cell"},"\xa0")}))):null}function P(e){return r.a.createElement("td",{className:"habit-cell"},r.a.createElement("div",{className:"habit-score-container"},e.up>0&&r.a.createElement("div",{className:"success center-wrapper"},r.a.createElement("span",null,"+",e.up)),e.down>0&&r.a.createElement("div",{className:"fail center-wrapper"},r.a.createElement("span",null,"-",e.down))))}a(109);var A=a(6);function U(e){var t=Object(n.useContext)(B).dates[0],a=e.data.filter((function(e){return m()(e.dateCompleted).isAfter(t)}));return r.a.createElement("section",{className:"todos"},r.a.createElement("h2",null,"Completed Todos"),r.a.createElement("ul",null,a.map((function(e){return r.a.createElement(L,{key:e.id,todo:e})}))))}function L(e){var t=m()(e.todo.dateCompleted).format("MMM D");return r.a.createElement("li",{className:"todo-row"},r.a.createElement(N,{task:e.todo}),r.a.createElement("span",{className:"todo-date date"},t),r.a.createElement("div",{className:"task-name",dangerouslySetInnerHTML:{__html:A.render(e.todo.text)}}))}var F="https://habitica.com/api/v3",B=r.a.createContext({showTaskIcons:!0,dates:Array(),cronIntervals:new i.a});function J(e){var t=Object(n.useState)(!0),a=Object(o.a)(t,2),l=a[0],c=a[1],s=Object(n.useState)(!0),u=Object(o.a)(s,2),d=u[0],f=u[1],h=Object(n.useState)(!0),p=Object(o.a)(h,2),v=p[0],b=p[1],y=Object(n.useState)(7),w=Object(o.a)(y,2),O=w[0],k=w[1],N=Object(n.useState)(!0),g=Object(o.a)(N,2),j=g[0],S=g[1],M=Object(n.useState)([]),T=Object(o.a)(M,2),R=T[0],I=T[1],x=Object(n.useState)([]),C=Object(o.a)(x,2),H=C[0],_=C[1],P=Object(n.useState)([]),A=Object(o.a)(P,2),L=A[0],J=A[1],W=Object(n.useState)([]),z=Object(o.a)(W,2),G=z[0],$=z[1],q=e.userId,Q=e.userApiKey,V=function(e){return fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-api-user":q,"x-api-key":Q,"x-client":"0d9428fd-d6fa-45f3-a4db-f130e3ef10ea-HabiticaTracker"}})},X=function(e){if(!e.success)throw new Error(e.message);return e},Z=e.setError;if(Object(n.useEffect)((function(){V(F+"/user").then((function(e){return e.json()})).then(X).then((function(e){I(e.data.history.exp.map((function(e){var t=m()(e.date);return[t.unix()-300,t.unix()+300]}))),c(!1)}),(function(e){Z(e)}))}),[]),Object(n.useEffect)((function(){V(F+"/tasks/user").then((function(e){return e.json()})).then(X).then((function(e){_(e.data.filter((function(e){return"habit"===e.type}))),J(e.data.filter((function(e){return"daily"===e.type}))),f(!1)}),(function(e){Z(e)}))}),[]),Object(n.useEffect)((function(){V(F+"/tasks/user?type=completedTodos").then((function(e){return e.json()})).then(X).then((function(e){$(e.data.filter((function(e){return"todo"===e.type}))),b(!1)}),(function(e){Z(e)}))}),[]),l||d||v)return r.a.createElement("div",{className:"App"},r.a.createElement("p",null,"Loading..."));var ee=new i.a;R.forEach((function(e){E.debug("cron: ".concat(m.a.unix(e[0])," - ").concat(m.a.unix(e[1]))),ee.insert(e[0],e[1],!0)}));var te,ae={showTaskIcons:j,dates:(te=O,Array(te).fill(0).map((function(e,t){return t+1})).reverse().map((function(e){return m()().subtract(e,"day").startOf("day")}))),cronIntervals:ee};return r.a.createElement("div",{className:"App"},r.a.createElement(B.Provider,{value:ae},r.a.createElement(K,{numDaysToShow:O,setNumDaysToShow:k,toggleTaskIcons:function(){return S(!j)}}),r.a.createElement(Y,{data:H}),r.a.createElement(D,{data:L}),r.a.createElement(U,{data:G})))}function K(e){var t=Object(n.useContext)(B),a=function(e){var t=e[0],a=e[e.length-1];if(t.month()===a.month())return a.format("MMMM YYYY");var n=t.year()===a.year()?"MMM":"MMM YYYY",r="MMM YYYY";return[t.format(n),a.format(r)].join("\u2013")}(t.dates);return r.a.createElement("div",{className:"app-controls"},r.a.createElement("div",null,r.a.createElement("span",{role:"button",className:"link",onClick:function(){return e.setNumDaysToShow(e.numDaysToShow+7)}},"+1 week"),e.numDaysToShow>7?r.a.createElement("span",null,r.a.createElement("span",null," / "),r.a.createElement("span",{role:"button",className:"link",onClick:function(){return e.setNumDaysToShow(e.numDaysToShow-7)}},"-1 week")):null),r.a.createElement("div",{className:"date-header"},a),r.a.createElement("span",{role:"button",className:"link",onClick:e.toggleTaskIcons,title:"Show/Hide task icons"},t.showTaskIcons?"Hide":"Show"," Task Icons"))}var W,z="YYYYMMDD";!function(e){e[e.PROMPT_FOR_USER_CREDS=0]="PROMPT_FOR_USER_CREDS",e[e.USER_INPUT_ACCEPTED=1]="USER_INPUT_ACCEPTED",e[e.ERROR=2]="ERROR"}(W||(W={}));var G=function(){var e=Object(n.useState)(""),t=Object(o.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)(""),s=Object(o.a)(c,2),i=s[0],u=s[1],m=Object(n.useState)(),d=Object(o.a)(m,2),f=d[0],E=d[1],h=Object(n.useState)(W.PROMPT_FOR_USER_CREDS),p=Object(o.a)(h,2),v=p[0],b=p[1];return v===W.PROMPT_FOR_USER_CREDS||v===W.ERROR?r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Habitica Tracker"),f&&r.a.createElement("div",{className:"error"},"Error: ",f.message),r.a.createElement("p",null,"This tool displays a history of your Habits, Dailies and Todos in Habitica."),r.a.createElement("p",null,"Your User ID and API key can be found on the"," ",r.a.createElement("a",{href:"https://habitica.com/user/settings/api",target:"_blank",rel:"noopener noreferrer"},"Settings > API")," ","page in Habitica."),r.a.createElement("form",{className:"user-api-form"},r.a.createElement("div",{className:"label-container"},r.a.createElement("div",{className:"label"},"User ID"),r.a.createElement("input",{type:"text",className:"user-id",value:a,onChange:function(e){l(e.target.value)}})),r.a.createElement("div",{className:"label-container"},r.a.createElement("span",{className:"label"},"API Key"),r.a.createElement("input",{type:"password",className:"api-key",value:i,onChange:function(e){u(e.target.value)},minLength:36})),r.a.createElement("div",{className:"submit-wrapper"},r.a.createElement("input",{type:"submit",value:"Fetch My Data",onClick:function(e){e.preventDefault(),b(W.USER_INPUT_ACCEPTED)}}))),r.a.createElement("h2",null,"Note"),r.a.createElement("ul",null,r.a.createElement("li",null,"Your user ID and API key will be sent to the Habitica servers and nowhere else."),r.a.createElement("li",null,"This app does not change your Habitica account data. It only fetches and displays data."))):r.a.createElement(J,{userId:a,userApiKey:i,setError:function(e){E(e),b(W.ERROR)}})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement("div",{className:"app-wrapper"},r.a.createElement(G,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},31:function(e,t,a){},32:function(e,t,a){},36:function(e,t,a){}},[[110,1,2]]]);
//# sourceMappingURL=main.b06fca55.chunk.js.map